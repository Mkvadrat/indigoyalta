/**
 * BUEditor Syntax Highlighter by ufku.com.
 * Requires: none
 * Usage: E.highlight('html');
 */
(function(k,e){var l={};l.hpad=0;l.vpad=0;var m=e("html"),q=parseInt(e.browser.version);if(e.browser.mozilla){l.hpad=2.5;m.addClass("mozilla mozilla-"+q)}else{if(e.browser.safari||e.browser.webkit){if(window.chrome){m.addClass("chrome")}else{m.addClass("safari")}l.vpad=3;m.addClass("webkit webkit-"+q)}else{if(e.browser.opera){m.addClass("opera opera-"+q)}else{if(e.browser.msie){m.addClass("ie ie-"+q)}}}}var t=function(x,w){setTimeout(function(){x(w)})};var g=function(w){t(BUE.hlUpdate,this)};var s=function(w){w.colayer.scrollTop=w.scrollTop};var u=function(){var w=this;s(w);t(s,w)};var d=function(){var x=this,z=e(document);var y=function(){s(x)};var w=function(){z.unbind("mousemove",y).unbind("mouseup",w);s(x)};z.mousemove(y).mouseup(w)};var j=function(){var x=this.bueT,A=e(x),z=e(x.colayer),B=e(document);var y=function(){z.height(A.height()-(l.vpad||0));return false};var w=function(){B.unbind("mousemove",y).unbind("mouseup",w);s(x)};B.mousemove(y).mouseup(w)};var h=function(){g.call(this.textArea);return this.hlOriginalSetContent.apply(this,arguments)};var r=e.browser.msie||e.browser.opera?s:function(){};BUE.hlighters=BUE.hlighters||{};var f={};var p=/&/g,c="&amp;";var o=/<(\/?([a-z][a-z0-9]*)[^<>]*>?)/g,b='<span class="bue-hl-tag bue-hl-tag-$2">&lt;$1</span>';var n=/<(?!\/?s)/g,a="&lt;";var i=e.browser.msie&&/^\s|\s(?=\s)|\s$/g,v="&nbsp;";BUE.hlighters.html=function(E,F){var x,K,y,B=p,A=o,z=n,J=c,H=b,G=a;var I=E.split("\n"),D=I.length,w="";for(var C=0;C<D;C++){K=I[C];y=f[K];if(y===x){f[K]=y=K.replace(B,J).replace(A,H).replace(z,G)}I[C]=y}return F?I:BUE.hlProcessLines(I)};BUE.hlProcessLines=function(w,y){if(!w||!w.length){return""}if(i){for(var z in w){w[z]=w[z].replace(i,v)}}var A="<span"+(y?' class="'+y+'"':"")+">";var x=A+w.join("<br /></span>"+A)+"<br /></span>";return x};BUE.hlFullText=function(w){w.colayer.innerHTML=BUE.hlighters[w.colang](BUE.text(w.value));t(s,w)};BUE.hlUpdate=function(B){if(l.tvalue==B.value){return r(B)}var y=l.tvalue;l.tvalue=B.value;if(!y||!B.value){return BUE.hlFullText(B)}var H=BUE.text(B.value).split("\n"),G=H.length;var E=BUE.text(y).split("\n"),w=E.length;var I=B.colayer,K=I.childNodes;for(var D=0;D<G;D++){if(H[D]!=E[D]){break}}for(var C=G-1,A=w-1;D<C&&D<A;C--,A--){if(H[C]!=E[A]){break}}var J=BUE.hlighters[B.colang],F="";for(var x=D;x<=C;x++){F+=J(H[x])}if(D==0&&A==w-1){I.innerHTML=F;return r(B)}var z=F?BUE.$html(F).get():[];if(A<D){e(I).append(z);return r(B)}for(x=D;x<A;x++){I.removeChild(K[D])}e(K[D]).replaceWith(z);r(B);return};BUE.hlColayer=function(x){if(x.colayer){return x.colayer}var w=x.colayer=document.createElement("div");var y=x.colayerParent=document.createElement("div");e(w).addClass("bue-hl-layer bue-hl-colayer").attr({id:x.id+"-bue-hl-colayer"});e(y).addClass("bue-hl-colayer-parent").attr({id:x.id+"-bue-hl-colayer-parent"}).append(w);return w};BUE.hlEnable=function(A,y){if(A.colayerParent&&e(A.colayerParent).css("display")!="none"){return true}if(!BUE.hlighters[y]||!A.offsetWidth){return false}var D=e(A),G=A.bue,B=D.next(".grippie"),C=BUE.selPos(A),z=A.scrollTop;G.hlOriginalSetContent=G.setContent;G.setContent=h;BUE.hlColayer(A);A.colang=y;if(B.size()){B[0].bueT=A;B.mousedown(j)}D.keydown(g).click(g).bind("drop",g);D.scroll(u).mousedown(d);e.browser.opera&&D.bind("mousewheel",A.weirdOScroll=function(){var E=this;s(E);setTimeout(function(){s(E)},400)});e.browser.msie&&e(window).scroll(A.weirdIEScroll=function(){s(A)});var H=e(A.colayerParent),x=D.prev(".preview").add(A)[0];H.next()[0]!=x&&H.insertBefore(x);H.css({display:"block"});D.addClass("bue-hl-layer bue-hl-textarea");var w=D.width()-(l.hpad||0);var F=D.height()-(l.vpad||0);e(A.colayer).css({height:F,width:w});BUE.hlUpdate(A);BUE.selMake(A,C.start,C.end);A.scrollTop=z;return true};BUE.hlDisable=function(x){if(!x.colayerParent||e(x.colayerParent).css("display")=="none"){return true}var A=e(x),z=x.bue,w=A.next(".grippie"),B=BUE.selPos(x),y=x.scrollTop;z.setContent=z.hlOriginalSetContent;e(x.colayerParent).css({display:"none"});A.removeClass("bue-hl-layer bue-hl-textarea");A.unbind("keydown",g).unbind("click",g).unbind("drop",g);A.unbind("scroll",u).unbind("mousedown",d);e.browser.opera&&A.unbind("mousewheel",x.weirdOScroll);e.browser.msie&&e(window).unbind("scroll",x.weirdIEScroll);if(w.size()){w.unbind("mousedown",j)}BUE.selMake(x,B.start,B.end);x.scrollTop=y;return true};BUE.preprocess.highlight=function(x,w){w(x.textArea).keydown(function(A){if(A.ctrlKey&&A.originalEvent.altKey&&A.keyCode==72){var y=this,z=y.bue;z.highlight(z.highlightOn?false:(y.colang||"html"));return false}})};k.highlight=function(y){var x=this,w=x.textArea;if(x.highlightOn){if(y){return x}x.highlightOn=!BUE.hlDisable(w)}else{if(!y){return x}x.highlightOn=BUE.hlEnable(w,y)}return x}})(BUE.instance.prototype,jQuery);
